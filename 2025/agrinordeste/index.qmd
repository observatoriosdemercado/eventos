---
title: "PERSPECTIVAS DO MERCADO DE MANGA E UVA 2025-2026."
author: "<br><br> JO√ÉO RICARDO F. DE LIMA <br><br> <br><br> Recife/PE, 05 de Setembro de 2025."
format: 
  revealjs:
    logo: "imgs/logo_embrapa.png" #https://www.remove.bg/pt-br/upload
    width: 1600
    height: 900
    slide-number: FALSE
    theme: serif
    css: estilos.css
    transition: fade
    toc: false
    progress: true
#/usr/local/bin/decktape reveal index.html presentation.pdf
# se for xaringa, trocar reveal por remark, mas antes precisa abrir o html opEM index.html
# pwd indica a pasta que est√° direcionado
# ls -l lista os arquivos da pasta atual
# cd .. volta para uma pasta anterior com espaco EMtre cd e  ..
# cd ~/Dropbox/Embrapa/2025/EvEMtos/Fruit\ Attraction/fruitsp2025 muda a pasta sendo que a \ √© por causa do espa√ßo
# se precisar abrir o html (erro de excesso de tempo) opEM index.html

---
## Jo√£o Ricardo Lima  üáßüá∑ {.center .aboutmeslide}

::: columns
::: {.column width="60%"}

-   Contatos

    -   Instagram: [\@jotaerre.econ](https://www.instagram.com/jotaerre.econ/)

    -   Email: [joao.ricardo@embrapa.br](joao.ricardo@embrapa.br)
    
    -   Linkedin: [Joao Ricardo Lima](https://www.linkedin.com/in/joao-ricardo-lima-7b6273240/)


-   Sobre mim

    -   Doutor em Economia Aplicada (UFV-MG)

    -   Pesquisador em Economia Rural da Embrapa Semi√°rido - Petrolina/PE
    
    -   Coordenador dos Observat√≥rios de Mercado de Manga e Uva da Embrapa
    
    -   Coordenador do Curso de Economia da FACAPE - Petrolina/PE

:::

::: {.column width="40%"}
![](imgs/jotaerre.png){width=110%}

:::
:::

## A QUEST√ÉO CLIM√ÅTICA

#### A quest√£o clim√°tica √© preocupa√ß√£o constante, mas 2025 √© um ano diferente de 2024.

<br>

::: columns
::: {.column width="50%"}

<div style="text-align: center;">
  <img src="imgs/fevereiro_24.png" width="150%">
</div>

:::
::: {.column width="50%"}

<div style="text-align: center;">
  <img src="imgs/fevereiro_25.png" width="150%">
</div>

:::
:::

Fonte: https://iri.columbia.edu/our-expertise/climate/forecasts/enso/current/

## A QUEST√ÉO CLIM√ÅTICA

#### Neutro domina praticamente todo o horizonte em 2025/2026.

<br>

::: columns
::: {.column width="50%"}

<div style="text-align: center;">
  <img src="imgs/julho_24.png" width="150%">
</div>

:::
::: {.column width="50%"}

<div style="text-align: center;">
  <img src="imgs/julho_25.png" width="150%">
</div>

:::
:::

Fonte: https://iri.columbia.edu/our-expertise/climate/forecasts/enso/current/

# A CULTURA DA MANGA

## AN√ÅLISE DA PRODU√á√ÉO DE MANGA  

#### Cada ano aumentam as √°reas cultivadas e a produtividade na regi√£o.

<div style="text-align: center;">
  <img src="imgs/area_manga.png" width="80%">
</div>

Fonte: [CEPEA, 2025.](https://www.hfbrasil.org.br/br/revista/acessar/completo/edicao-de-dezembro-anuario-2024-2025.aspx)

## AN√ÅLISE DA OFERTA DE MANGA  

#### Nos √∫ltimos 10 anos, a produ√ß√£o de manga praticamente duplicou.

```{python agrinordeste1, echo=FALSE, out.width="100%"}
from plotnine import *
import pandas as pd
import numpy as np

# Lendo os dados
dados2 = pd.read_excel("dados/tabela1.xlsx")
dados2["Ano"] = dados2["Ano"].astype(str)

# Gr√°fico
plot = (
    ggplot(dados2) +
    geom_col(aes(x='Ano', y='Manga / 1000'), fill="gold") +
    scale_y_continuous(breaks=[200, 400, 600, 800, 1000, 1200, 1400, 1600]) +
    labs(
        y='Mil Toneladas',
        x='anos',
        caption='Fonte: IBGE (2024). Dados reprocessados pelo Observat√≥rio de Manga da Embrapa.'
    ) +
    theme_minimal() +
    theme(
        axis_text_x=element_text(angle=45, ha='center', size=18),
        axis_text_y=element_text(size=18),
        axis_title_x=element_text(size=18, weight='bold'),
        axis_title_y=element_text(size=18, weight='bold'),
        panel_grid_major=element_blank(),
        panel_grid_minor=element_blank(),
        plot_caption=element_text(ha='left', size=16),
        legend_title=element_blank(),
        legend_text=element_text(size=8),
        legend_position='none',
        figure_size=(14, 6.5)
    )
)

plot.show

```

# O MERCADO EXTERNO

- EXPORTA√á√ïES 2025
- A SITUA√á√ÉO DOS EUA

## EXPORTA√á√ïES BRASILEIRAS DE MANGAS

```{python agrinordeste2, echo=FALSE, message=FALSE}
import pandas as pd
from plotnine import *

# Carregar os dados
dados1 = pd.read_csv('dados/exportacoes_2012_2025.csv', sep=';', decimal='.')
# Garante os nomes das colunas (ajuste se o CSV j√° vier nomeado)
dados1.columns = ['Ano', 'Valor', 'Toneladas']

# Sequ√™ncia de anos 2012..2025 (comprimEMto = n√∫mero de linhas do arquivo)
dados1['Ano'] = pd.RangeIndex(start=2012, stop=2012 + len(dados1), step=1)

# Converte unidades para milhares apEMas nas colunas num√©ricas desejadas
dados1[['Valor', 'Toneladas']] = dados1[['Valor', 'Toneladas']] / 1000

plot = (
    ggplot(dados1, aes(x='Ano'))
    # Barras: Mil Toneladas
+ geom_col(aes(y='Toneladas', fill='"Mil toneladas"'), width=0.8, show_legend=True)
+ geom_line(aes(y='Valor', color='"Milh√µes de d√≥lares"'), size=2.2, show_legend=True)
+ scale_fill_manual(name='', values={'Mil toneladas': '#FFD700'})
+ scale_color_manual(name='', values={'Milh√µes de d√≥lares': '#FF0000'})
    + guides(fill=guide_legend(order=1), color=guide_legend(order=2))
    # Eixos, r√≥tulos e quebras
    + scale_x_continuous(breaks=range(2012, 2026))
    + labs(
    x='anos',
    y='US$ Milh√µes / Mil Toneladas',
    title='',
    caption='Fonte: COMEXSTAT (2025). Dados reprocessados pelo Observat√≥rio de Manga da Embrapa.\n'
            'Obs.: Dados at√© o m√™s de Agosto de 2025.'
    )
    + theme_minimal()
    + theme(
        legend_position='bottom',
        legend_title=element_blank(),
        legend_text=element_text(size=18),
        axis_title_x=element_text(weight='bold', size=18),
        axis_title_y=element_text(weight='bold', size=18),
        axis_text_x=element_text(size=18),
        axis_text_y=element_text(size=18),
        plot_caption=element_text(ha='left', size=18),
        figure_size=(14, 6.5)
    )
)

plot.show

```


## EXPORTA√á√ïES BRASILEIRAS DE MANGAS

```{python agrinordeste3, echo=FALSE, message=FALSE}
# pip install pandas plotnine
import pandas as pd
from plotnine import *

# --- 1) Ler dados e preparar ---
df = pd.read_csv('dados/total_exporta_br.csv', sep=';', decimal='.')  # troque decimal=',' se precisar

# nomes esperados: ano, mes, valor, quilo
df.columns = [c.strip().lower() for c in df.columns]

# quilo ‚Üí mil toneladas
df['toneladas'] = df['quilo'] / 1000000

# meses em PT-BR (ordem correta)
mes_map = {
    1: 'janeiro',  2: 'fevereiro', 3: 'mar√ßo',    4: 'abril',
    5: 'maio',     6: 'junho',     7: 'julho',    8: 'agosto',
    9: 'setembro', 10: 'outubro',  11: 'novembro', 12: 'dezembro'
}

ordem_meses = [mes_map[m] for m in range(1,13)]
df['Mes'] = df['mes'].map(mes_map)
df['Mes'] = pd.Categorical(df['Mes'], categories=ordem_meses, ordered=True)

# --- 2) M√©dia mEMsal (2012‚Äì2024) ---
media_1224 = (
    df.query('2012 <= ano <= 2024')
      .groupby('Mes', as_index=False)['toneladas']
      .mean()
      .rename(columns={'toneladas':'Media_2012_2024'})
)

# --- 3) Dados das barras (2023, 2024, 2025) ---
bars = df[df['ano'].isin([2023, 2024, 2025])].copy()
bars['AnoLabel'] = bars['ano'].astype(str)  # '2023','2024','2025'

# --- 4) Cores (ajuste se quiser chegar 100% no seu palette) ---
cores_barras = {'2023': '#9ecae1', '2024': '#6b6b6b', '2025': '#FFD700'}  # azul claro, cinza, amarelo
cor_linha   = {'Media (2012‚Äì2024)': '#F2672b'}  # laranja

plot = (
    ggplot()
    # Barras
    + geom_col(
        mapping=aes(x='Mes', y='toneladas', fill='AnoLabel'),
        data=bars,
        position=position_dodge(width=0.8),
        width=0.75,
        show_legend=True
    )
    # Linha m√©dia 2012‚Äì2024
    + geom_line(
        mapping=aes(x='Mes', y='Media_2012_2024', group=1, color='"Media (2012‚Äì2024)"'),
        data=media_1224,
        size=1.8,
        show_legend=True
    )
    + geom_point(
        mapping=aes(x='Mes', y='Media_2012_2024', color='"Media (2012‚Äì2024)"'),
        data=media_1224,
        size=2.2,
        show_legend=False
    )
    + scale_fill_manual(name='', values={'2023':'#9ecae1','2024':'#6b6b6b','2025':'#FFD700'})
    + scale_color_manual(name='', values={'Media (2012‚Äì2024)':'#F2672b'})
+ labs(
    x='Meses del ano',
    y='Mil Toneladas',
    caption='Fonte: COMEXSTAT (2025). Dados reprocessados pelo Observat√≥rio de Manga da Embrapa.\n'
            'Obs.: Dados at√© o m√™s de Agosto de 2025.'
)

    + theme_minimal()    
    + theme(
        legend_position='bottom',
        legend_title=element_blank(),
        legend_text=element_text(size=18),
        axis_title_x=element_text(weight='bold', size=18),
        axis_title_y=element_text(weight='bold', size=18),
        axis_text_x=element_text(size=16),
        axis_text_y=element_text(size=18),
        plot_caption=element_text(ha='left', size=18),
        figure_size=(14, 6.5)
    )
)


plot.show()
```


## EXPORTA√á√ïES BRASILEIRAS DE MANGAS

```{python agrinordeste4, echo=FALSE, message=FALSE}
# pip install pandas plotnine opEMpyxl
import pandas as pd
from plotnine import *
import numpy as np

# 1) Leer el archivo (ajusta la ruta si es necesario)
df = pd.read_excel('dados/exportacÃßoes_semanais_manga.xlsx')
df.columns = [str(c).strip() for c in df.columns]

# 2) Asegurar num√©ricos y construir el total Europa+Reino Unido
for c in ['Europa', 'Reino Unido']:
    df[c] = pd.to_numeric(df[c], errors='coerce')

df['Total_cont'] = df['Europa'].fillna(0) + df['Reino Unido'].fillna(0)

# 3) MantEMer solo ano (Data) y semana (Semanas) v√°lidos
df['Data'] = pd.to_numeric(df['Data'], errors='coerce')
df['Semanas'] = pd.to_numeric(df['Semanas'], errors='coerce')
df = df.dropna(subset=['Data','Semanas'])

# 4) Agregar por semana (por si hubiera duplicados) y preparar 2024 y 2025
base24 = (
    df[df['Data'] == 2024]
      .groupby('Semanas', as_index=False)['Total_cont'].sum()
      .rename(columns={'Total_cont':'total_2024'})
)

base25 = (
    df[df['Data'] == 2025]
      .groupby('Semanas', as_index=False)['Total_cont'].sum()
      .rename(columns={'Total_cont':'total_2025'})
)

# 5) Unir SOLO semanas comparables (intersecci√≥n) y limitar a 1‚Äì34
comp = pd.merge(base25, base24, on='Semanas', how='inner')
comp = comp[comp['Semanas'].between(1, 36)].sort_values('Semanas')

# 6) Variaci√≥n porcEMtual 2025 vs 2024
comp['var_pct'] = (comp['total_2025'] - comp['total_2024']) / comp['total_2024'] * 100
# evitar divisi√≥n por cero
comp.loc[comp['total_2024'] == 0, 'var_pct'] = np.nan
comp = comp.dropna(subset=['var_pct'])

# 7) Gr√°fico (plotnine)
AZUL_PRODUCTOR = "blue"  # reemplaza por tu azul exacto

plot = (
    ggplot(comp, aes(x='Semanas', y='var_pct'))
    + geom_col(width=0.8, fill=AZUL_PRODUCTOR)
    + geom_hline(yintercept=0, linetype='dashed', size=1)
    + scale_x_continuous(breaks=range(1, 36))
    + scale_y_continuous(labels=lambda l: [f'{v:.0f}%' for v in l])
    + labs(
    title='',
    x='Semanas do ano',
    y='Varia√ß√£o interanual (%) de cont√™ineres exportados ‚Äî 2025 vs 2024',
    caption='Fonte: COMEXSTAT (2025). Dados reprocessados pelo Observat√≥rio de Manga da Embrapa.\n'
            'Nota: Compara√ß√£o realizada apenas para as semanas 1‚Äì35.'
)
    + theme_minimal()
    + theme(
        legend_position='none',
        axis_title_x=element_text(weight='bold', size=18),
        axis_title_y=element_text(weight='bold', size=12),
        axis_text_x=element_text(size=18),
        axis_text_y=element_text(size=18),
        plot_caption=element_text(ha='left', size=16),
        figure_size=(14, 6.5)
    )
)

# Mostrar / guardar
plot.show()

```

## EXPORTA√á√ïES BRASILEIRAS DE MANGAS

```{python agrinordeste5, echo=FALSE, message=FALSE}
import pandas as pd
from plotnine import *

# --- 1) Ler ---
df = pd.read_excel('dados/destinos_2425.xlsx')
df.columns = ['Paises', '2024', '2025']

# Padronizar nomes (se precisar)
df['Paises'] = df['Paises'].replace({
    'Paises Bajos': 'Holanda',
    'Espanha': 'Espanha',
    'Canada': 'Canada',
    'Coreia do Sul': 'Coreia do Sul',
    'Estados Unidos': 'Estados Unidos'
})

# 2) Converter colunas de valores para num√©rico
for c in ['2024', '2025']:
    # remove percentuais e separadores t√≠picos
    df[c] = (df[c].astype(str)
                  .str.replace('%', '', regex=False)
                  .str.replace('.', '', regex=False)     # separador de milhar
                  .str.replace(',', '.', regex=False))   # v√≠rgula -> ponto
    df[c] = pd.to_numeric(df[c], errors='coerce')

# 3) escolher nome da coluna de pa√≠ses
col = 'Pa√≠ses' if 'Pa√≠ses' in df.columns else 'Paises'

# 4) ordem desejada (use exatamente os mesmos nomes da coluna!)
ordem = ['Holanda','Espanha','Estados Unidos','Reino Unido','Portugal',
         'Canada','Chile','Coreia do Sul','Argentina']  # <‚Äî sem acento em "Coreia"

df[col] = pd.Categorical(df[col], categories=ordem, ordered=True)

# 5) Derreter (melt)
dados1m = df.melt(id_vars=col, var_name='variable', value_name='value')

# 6) Gr√°fico
mycolors2 = ["#006400", "#FFA500"]

plot = (
    ggplot(dados1m, aes(x=col, y='value', fill='variable'))
    + geom_col(position=position_dodge(width=0.9), na_rm=True)
    + geom_text(
        aes(label='value'),
        position=position_dodge(0.9),
        va='bottom',
        size=14
    )
    + scale_fill_manual(values=mycolors2)
    + labs(
        y="Participa√ß√£o (%)",
        x="Pa√≠ses",
        title="",
        caption="Fonte: COMEXSTAT (2025). Dados reprocessados pelo Observat√≥rio de Manga da Embrapa."
    )
    + theme_minimal()
    + theme(
        figure_size=(14, 6.5),
        axis_title_y=element_text(size=18, weight="bold"),
        axis_title_x=element_text(size=18, weight="bold"),
        axis_text_x=element_text(hjust=0.5, size=15),
        axis_text_y=element_text(size=18),
        plot_caption=element_text(ha='left', size=16),
        legend_position='bottom',
        legend_text=element_text(size=16),
        legend_title=element_text(text='')
    )
)

# Em notebooks Python: print(plot) ou plot.save("grafico.png", dpi=300, width=14, height=6.5)

# Mostrar o gr√°fico
plot.show()

```

## EXPORTA√á√ïES BRASIL-EUA DE MANGA 

::: columns
::: {.column width="50%"}

<br>

- 2 de abril de 2025: Trump anuncia uma tarifa b√°sica de 10% sobre as importa√ß√µes de quase todos os pa√≠ses, incluindo o Brasil. A medida entra em vigor em 5 de abril.

- 9 de julho de 2025: √â anunciada uma tarifa adicional de 40% sobre os produtos brasileiros, elevando a carga total para 50% a partir de 1¬∫ de agosto de 2025.

- Os exportadores brasileiros de manga decidem realizar envios aos Estados Unidos.

:::

::: {.column width="50%"}

<br>

- 31 de julho de 2025: A aplica√ß√£o dessas tarifas √© adiada para 6 de agosto, por decis√£o executiva.

- Na ordem publicada, Trump incluiu uma lista de aproximadamente 700 produtos exclu√≠dos da nova tarifa ‚Äî como aeronaves civis, pe√ßas de avi√µes, suco de laranja, energia e fertilizantes.

- 6 de agosto de 2025: In√≠cio da aplica√ß√£o das tarifas, incluindo as exporta√ß√µes de manga.

:::
:::

## EXPORTA√á√ïES BRASIL-EUA DE MANGA 

```{python agrinordeste6, echo=FALSE, message=FALSE}
import pandas as pd
from plotnine import *

# Carregar os dados
df = pd.read_csv('dados/previsao_2425.csv', sep=';')

# Remover as colunas indesejadas
df = df.drop(columns=[
    "Proyecci√≥n de Embarques en Cajas 2024",
    "Proyecci√≥n de Embarques en Cajas 2025"
])

# üîÅ RENOMEAR as colunas pedidas (ES ‚Üí PT-BR)
rename_map = {
    'Proyecci√≥n de Embarques en Contenedores 2024': 'Proje√ß√£o de Embarques em Cont√™ineres 2024',
    'Proyecci√≥n de Embarques en Contenedores 2025': 'Proje√ß√£o de Embarques em Cont√™ineres 2025'
}
df = df.rename(columns=rename_map)

# Reorganizar para formato longo
df_long = pd.melt(
    df,
    id_vars='semanas',
    value_vars=[
        'Proje√ß√£o de Embarques em Cont√™ineres 2024',
        'Proje√ß√£o de Embarques em Cont√™ineres 2025'
    ],
    var_name='ano',
    value_name='Quantidade de Cont√™ineres'   # PT-BR
)

# Gr√°fico com legenda e cores corretas
plot = (
    ggplot(df_long, aes(x='semanas', y='Quantidade de Cont√™ineres', color='ano')) +
    geom_line(size=2) +
    scale_color_manual(values={
        'Proje√ß√£o de Embarques em Cont√™ineres 2024': 'darkgreen',
        'Proje√ß√£o de Embarques em Cont√™ineres 2025': 'red'
    }) +
    labs(
        title='',
        x='Semanas',
        y='Quantidade de Cont√™ineres',
        color='ano',
        caption='Fonte: Valexport (2025) e Mango Board (2025). '
                'Dados reprocessados pelo Observat√≥rio de Mercado de Manga da Embrapa.'
    ) +
    scale_x_continuous(breaks=range(31, 50, 1)) +
    scale_y_continuous(breaks=range(0, 300, 25)) +
    theme_minimal() +
    theme(
        axis_title_x=element_text(size=18, face="bold"),
        axis_title_y=element_text(size=18, face="bold"),
        axis_text_x=element_text(size=18),
        axis_text_y=element_text(size=18),
        legend_position='bottom',
        legend_text=element_text(size=16),
        legend_title=element_text(text=''),
        plot_caption=element_text(ha='left', size=16),
        figure_size=(14, 6.5)
    )
)

# valores nos picos conhecidos (ATUALIZADOS para os novos nomes PT-BR)
y36_2025 = float(
    df.loc[df['semanas'] == 36, 'Proje√ß√£o de Embarques em Cont√™ineres 2025'].iloc[0]
)
y40_2024 = float(
    df.loc[df['semanas'] == 40, 'Proje√ß√£o de Embarques em Cont√™ineres 2024'].iloc[0]
)

# dataframes para os r√≥tulos
df_lab25 = pd.DataFrame({
    'semanas': [36],
    'Quantidade de Cont√™ineres': [y36_2025],
    'lbl': [f'M√°ximo projetado 2025\nsemana 36: {y36_2025:.0f}']
})
df_lab24 = pd.DataFrame({
    'semanas': [40],
    'Quantidade de Cont√™ineres': [y40_2024],
    'lbl': [f'M√°ximo projetado 2024\nsemana 40: {y40_2024:.0f}']
})

# adicionar as duas anota√ß√µes (sem herdar o mapeamento de cor do plot)
plot = (
    plot
    # 2025 - vermelho
    + geom_point(
        data=df_lab25,
        mapping=aes(x='semanas', y='Quantidade de Cont√™ineres'),
        size=3, color='red', inherit_aes=False, show_legend=False
    )
    + geom_text(
        data=df_lab25,
        mapping=aes(x='semanas', y='Quantidade de Cont√™ineres', label='lbl'),
        nudge_x=0.3, nudge_y=15, size=13, color='red',
        inherit_aes=False, show_legend=False
    )
    # 2024 - verde
    + geom_point(
        data=df_lab24,
        mapping=aes(x='semanas', y='Quantidade de Cont√™ineres'),
        size=3, color='darkgreen', inherit_aes=False, show_legend=False
    )
    + geom_text(
        data=df_lab24,
        mapping=aes(x='semanas', y='Quantidade de Cont√™ineres', label='lbl'),
        nudge_x=0.3, nudge_y=15, size=13, color='darkgreen',
        inherit_aes=False, show_legend=False
    )
)

plot.show()
```


## EXPORTA√á√ïES BRASIL-EUA DE MANGA 

::: columns
::: {.column width="60%"}

<br>

- Projeta-se um aumento pr√≥ximo de 10%, de 1.900 para 2.100 cont√™ineres. Contudo, at√© o dado da semana 35, o efetivo ficou bem abaixo do projetado (cerca de 674 projetado e 369 efetivamente enviados). 

- Em 2025, o pico de embarques est√° projetado para ocorrer na semana 36, diferente de 2024, quando o pico estava previsto para a semana 40.

- Aproveitando os pre√ßos mais altos, como consequ√™ncia da redu√ß√£o dos volumes exportados pelo M√©xico no encerramento da temporada.

:::

::: {.column width="40%"}

![](imgs/hidro.jpg){width=85%}

:::
:::


## EXPORTA√á√ïES BRASIL-EUA DE MANGA 

```{python agrinordeste7, echo=FALSE, message=FALSE}
import pandas as pd
from numpy import arange
import math
from datetime import date
from dateutil.relativedelta import relativedelta
import requests

from plotnine import (
    ggplot, aes, geom_line, geom_point, geom_text, annotate,
    scale_x_date, scale_y_continuous, labs, theme_minimal, theme
)
from plotnine.themes.elements import element_text

# --- Par√¢metros de per√≠odo (√∫ltimos 12 meses at√© hoje) ---
hoje = date.today()
inicio = hoje - relativedelta(months=12)
fmt = "%d/%m/%Y"

# --- S√©rie SGS (PTAX venda di√°ria = 1) ---
url = (f"https://api.bcb.gov.br/dados/serie/bcdata.sgs.1/dados"
       f"?formato=json&dataInicial={inicio.strftime(fmt)}&dataFinal={hoje.strftime(fmt)}")

# --- Baixa e prepara dados ---
resp = requests.get(url, timeout=30)
resp.raise_for_status()
df = pd.DataFrame(resp.json())
df["data"]  = pd.to_datetime(df["data"], format="%d/%m/%Y")
df["valor"] = pd.to_numeric(df["valor"].str.replace(",", ".", regex=False))
df = df.sort_values("data").reset_index(drop=True)

# --- fun: pega a data dispon√≠vel mais pr√≥xima ---
def get_nearest(df, date_str):
    d = pd.to_datetime(date_str)
    i = (df["data"] - d).abs().idxmin()
    return df.loc[i, "data"], df.loc[i, "valor"]

# Datas-alvo
eleicao, v_eleicao = get_nearest(df, "2024-11-05")
t10, v_t10         = get_nearest(df, "2025-04-02")
t50, v_t50         = get_nearest(df, "2025-07-09")
# nova data: posse (toma de posesi√≥n)
tpos, v_tpos = get_nearest(df, "2025-01-20")
# √öltimo debate antes das elei√ß√µes (1¬∫ de outubro de 2024)
ult_debate, v_ult_debate = get_nearest(df, "2024-10-01")

# Quebras do eixo Y: de 0,10 em 0,10
min_break = math.floor(df["valor"].min()*10)/10
max_break = math.ceil(df["valor"].max()*10)/10
breaks_ = arange(min_break, max_break+0.1, 0.10)

# Helper p/ formatar decimal com v√≠rgula no label
fmt_pt = lambda v: f"{v:.2f}".replace(".", ",")

plot = (
    ggplot(df, aes("data", "valor"))
    + geom_line(color="red", size=1.2)

    # pontos-√¢ncora nas tr√™s datas
    + geom_point(aes(x=eleicao, y=v_eleicao), size=2.5)
    + geom_point(aes(x=t10,     y=v_t10),     size=2.5)
    + geom_point(aes(x=t50,     y=v_t50),     size=2.5)
    + geom_point(aes(x=tpos, y=v_tpos), size=2.5)
    # ponto
    + geom_point(aes(x=ult_debate, y=v_ult_debate), size=2.5)
    # textos estilo ‚Äúcallout‚Äù (sem linhas verticais)
    + geom_text(aes(x=eleicao, y=v_eleicao),
                label=f"Elei√ß√£o EUA\n{fmt_pt(v_eleicao)}", nudge_y=0.12, ha="left", size=15)
    + geom_text(aes(x=t10, y=v_t10),
                label=f"Imposto 10%\n{fmt_pt(v_t10)}", nudge_y=0.12, ha="left", size=15)
    + geom_text(aes(x=t50, y=v_t50),
                label=f"Imposto 50%\n{fmt_pt(v_t50)}", nudge_y=0.12, ha="left", size=15)
    + geom_text(aes(x=tpos, y=v_tpos),
            label=f"Posse do Trump\n{fmt_pt(v_tpos)}", nudge_y=0.12, ha="left", size=15)# texto estilo callout
    + geom_text(
    aes(x=ult_debate, y=v_ult_debate),
    label=f"√öltimo debate K x T\n{fmt_pt(v_ult_debate)}",
    nudge_y=0.12, ha="left", size=15
)
    # setinhas discretas (opcional ‚Äî comEMte se n√£o quiser)
    + annotate("segment", x=eleicao, xend=eleicao, y=v_eleicao+0.10, yend=v_eleicao+0.02, alpha=0.7)
    + annotate("segment", x=t10,     xend=t10,     y=v_t10+0.10,     yend=v_t10+0.02,     alpha=0.7)
    + annotate("segment", x=t50,     xend=t50,     y=v_t50+0.10,     yend=v_t50+0.02,     alpha=0.7)
    # (opcional) setinha discreta
  + annotate("segment", x=tpos, xend=tpos, y=v_tpos+0.10, yend=v_tpos+0.02, alpha=0.7)
  # setinha opcional
  + annotate(
    "segment",
    x=ult_debate, xend=ult_debate,
    y=v_ult_debate+0.10, yend=v_ult_debate+0.02,
    alpha=0.7
)
    + scale_x_date(date_breaks="1 month", date_labels="%b/%Y")
    + scale_y_continuous(
        breaks=breaks_,
        labels=lambda l: [fmt_pt(v) for v in l]
    )
    + labs(
        x="Meses do ano",
        y="Taxa de cambio real (R$/US$)",
        title="",
        caption="Fonte: Banco Central do Brasil (SGS 1 ‚Äî PTAX Venda diaria). Dados reprocessados pelo Observat√≥rio de Mercado de Manga da Embrapa."
    )
    + theme_minimal()
    + theme(
        axis_title_x=element_text(size=18, face="bold"),
        axis_title_y=element_text(size=18, face="bold"),
        axis_text_y=element_text(size=18, face="bold"),
        axis_text_x=element_text(angle=45, ha='center', size=16),
        plot_title=element_text(size=14, weight="bold"),
        plot_caption=element_text(ha='left', size=16),
        figure_size=(14, 6.5)
    )
)

plot.show()
```

# O MERCADO INTERNO

- DEMANDA
- PRE√áOS
- CARACTER√çSTICAS
- DESAFIOS

## AN√ÅLISE DA DEMANDA DE MANGA 

```{python agrinordeste8, echo=FALSE, message=FALSE}

import pandas as pd
from plotnine import *
from mizani.formatters import date_format
import matplotlib.pyplot as plt

# Load the CSV file
data = pd.read_csv('dados/ipca_manga.csv', sep=';', decimal='.')

# Traduzir os meses do portugu√™s para o ingl√™s
meses_pt_en = {
    'jan': 'Jan', 'fev': 'Feb', 'mar': 'Mar', 'abr': 'Apr',
    'mai': 'May', 'jun': 'Jun', 'jul': 'Jul', 'ago': 'Aug',
    'set': 'Sep', 'out': 'Oct', 'nov': 'Nov', 'dez': 'Dec'
}

# Aplicar substitui√ß√£o
data['mes_EM'] = data['mes'].str.lower().replace(meses_pt_en, regex=True)

# Converter para datetime
data['mes_EM'] = pd.to_datetime(data['mes_EM'], format='%b/%y')

# Criar o gr√°fico
plot = (
    ggplot(data, aes(x='mes_EM', y='pe_manga')) +
    geom_line(color='darkblue', size=1.5) +
    labs(
        title='',
        x='Meses do ano',
        y='Peso no or√ßamento da Fam√≠lia',
        caption='Fonte: IPCA/IBGE (2025). Dados reprocessados pelo Observat√≥rio de Manga da Embrapa.'
    ) +
    scale_x_datetime(date_breaks='6 months', date_labels='%b/%y') +
    theme_minimal() +
    theme(
        figure_size=(14, 6.5),
        axis_title_y=element_text(size=14, face="bold"),
        axis_title_x=element_text(size=14, face="bold"),
        axis_text_x=element_text(rotation=45, hjust=1, size=14),
        axis_text_y=element_text(size=18),
        plot_caption=element_text(ha='left', size=12)
    )
)

# Mostrar o gr√°fico
plot.show()

```

## PRE√áOS RECEBIDOS PELOS PRODUTORES

```{python agrinordeste9, echo=FALSE, message=FALSE}
import pandas as pd
from pathlib import Path
import plotnine as p9
from mizani.formatters import number_format, date_format

# Caminho para os arquivos
data_dir = Path("/Users/jricardofl/Dropbox/tempecon/dados_manga")

df = (
    pd.read_csv(data_dir/'dados_manga_palmer_semana.csv', sep=';', decimal='.')
    .drop(columns=['produto', 'regiao', 'ano', 'semana'])
)

# Cria o intervalo de dados de 2012-01-07 ate a semana de 2025
date_range = pd.date_range(start='2012-01-01', end='2025-09-05', freq='W-SAT')

# Remove datas especificas (semana 53)
dates_to_remove = [pd.Timestamp('2016-12-31'), pd.Timestamp('2022-12-31')]
date_range = date_range[~date_range.isin(dates_to_remove)]

# Designa a date range como uma nova coluna
df['date'] = date_range[:len(df)]

df['date2'] = date_range[:len(df)]

# Configura a data como index
df = df.set_index('date')

# Carrega igpdi dataset
igpdi = (
    pd.read_csv(data_dir/'igpdi.csv', sep=';', decimal='.')
    .assign(date=df.index)
    .drop(columns=['ano', 'semana'])
    .set_index('date')
)

# Junta os DataFrames
tabela = df.join(igpdi, how='inner')

# Deflaciona a serie de pre√ßos de manga
indice_data_base = tabela.query("date == date.max()").igpdi.values[0]
tabela = tabela.assign(real=lambda x: (indice_data_base / x.igpdi) * x.preco)

# Cria√ß√£o da vari√°vel preco_palmer
preco_palmer = tabela['real']

# Estima a tendEMcia por m√©dia m√≥vel
#trend_palmer = preco_palmer.rolling(window=52, center=True).mean()

# Gr√°fico

# Visualiza√ß√£o de dados

plot = (
    p9.ggplot(tabela) +
    p9.aes(x="date2") + 
    p9.geom_line(p9.aes(y="real"), color="blue", size=1) + 
    scale_y_continuous(breaks=[1, 2, 3, 4, 5, 6, 7, 8]) +
    p9.scale_x_date(
        date_breaks="1 year", date_labels="%Y"
    ) +
    p9.labs(
        x="Semanas de cada ano",
        y="Pre√ßos deflacionados de Manga Palmer (R$/kg)",
        caption="Fonte: CEPEA (2025). Dados reprocessados pelo Observat√≥rio de Manga da Embrapa."
    ) +
    p9.theme_minimal() +
    p9.theme(
        axis_title_x=element_text(size=15, face="bold"),
        axis_title_y=element_text(size=16, face="bold"),
        axis_text_x=element_text(size=18),
        axis_text_y=element_text(size=18),
        legend_title=element_text(size=14),
        legend_text=element_text(size=12),
        plot_caption=element_text(ha='left', size=16),
        figure_size=(14, 6.5)
    )
)

# Mostra o gr√°fico
plot.show()
```

## PRE√áOS RECEBIDOS PELOS PRODUTORES

```{python agrinordeste10, echo=FALSE, message=FALSE}
import pandas as pd
from pathlib import Path
from plotnine import *

# ----------------------------
# 1) Leitura e prepara√ß√£o (seu bloco)
# ----------------------------
data_dir = Path("/Users/jricardofl/Dropbox/tempecon/dados_manga")

df = (
    pd.read_csv(data_dir/'dados_manga_palmer_semana.csv', sep=';', decimal='.')
    .drop(columns=['produto', 'regiao', 'ano', 'semana'])
)

# Intervalo semanal (W-SAT) e remo√ß√£o das semanas 53
date_range = pd.date_range(start='2012-01-01', end='2025-09-05', freq='W-SAT')
dates_to_remove = [pd.Timestamp('2016-12-31'), pd.Timestamp('2022-12-31')]
date_range = date_range[~date_range.isin(dates_to_remove)]

# Atribui datas e index
df['date'] = date_range[:len(df)]
df['date2'] = date_range[:len(df)]  # se precisar manter
df = df.set_index('date')

# IGP-DI com o mesmo √≠ndice temporal
igpdi = (
    pd.read_csv(data_dir/'igpdi.csv', sep=';', decimal='.')
    .assign(date=df.index)            # for√ßa alinhamento 1-para-1 por posi√ß√£o
    .drop(columns=['ano', 'semana'])
    .set_index('date')
)

# Join e deflacionamento
tabela = df.join(igpdi, how='inner')
indice_data_base = tabela.query("date == date.max()").igpdi.values[0]
tabela = tabela.assign(real=lambda x: (indice_data_base / x.igpdi) * x.preco)

# S√©rie final (pre√ßo real deflacionado)
preco_palmer = tabela['real']

# ----------------------------
# 2) Construir ano/semana (52 semanas por ano)
# ----------------------------
dados = tabela[['real']].rename(columns={'real': 'preco'})
dados['ano'] = dados.index.year
# semana = contagem sequencial dentro de cada ano (1..52)
dados['semana'] = dados.groupby('ano').cumcount() + 1

# Garantia: manter apenas semanas 1..52
dados = dados.query('1 <= semana <= 52').reset_index()

# ----------------------------
# 3) M√©dia semanal (2022‚Äì2024) e dados de barras (2023‚Äì2025)
# ----------------------------
media_224 = (
    dados.query('2022 <= ano <= 2024')
         .groupby('semana', as_index=False)['preco']
         .mean()
         .rename(columns={'preco': 'Media_2022_2024'})
)

bars = dados.query('ano in [2023, 2024, 2025]').copy()
bars['AnoLabel'] = bars['ano'].astype(str)

# ----------------------------
# 4) Plot (estilo da figura enviada)
# ----------------------------
cores_barras = {'2023': '#9ecae1', '2024': '#6b6b6b', '2025': '#FFD700'}
#cores_barras = {
#    '2023': '#1f77b4',   # azul mais escuro
#    '2024': '#6b6b6b',   # cinza
#    '2025': '#e6b800'    # amarelo/dourado mais forte
#}
cor_linha   = {'M√©dia (2022‚Äì2024)': '#F2672b'}

plot = (
    ggplot()
    # Barras semanais
    + geom_col(
        aes(x='semana', y='preco', fill='AnoLabel'),
        data=bars,
        position=position_dodge(width=0.8),
        width=0.72
    )
    # Linha da m√©dia 2022‚Äì2024
    + geom_line(
        aes(x='semana', y='Media_2022_2024', group=1, color='"M√©dia (2022‚Äì2024)"'),
        data=media_224,
        size=1.6
    )
    + geom_point(
        aes(x='semana', y='Media_2022_2024', color='"M√©dia (2022‚Äì2024)"'),
        data=media_224,
        size=2.1
    )
    + scale_fill_manual(name='', values=cores_barras)
    + scale_color_manual(name='', values=cor_linha)
    + scale_x_continuous(breaks=range(1, 53, 3))   # <--- eixo de 3 em 3
    + labs(
        x='Semanas de cada Ano',
        y='Pre√ßo Palmer (R$)',
        caption='Fonte: CEPEA (2025). Dados reprocessados pelo Observat√≥rio de Manga da Embrapa.'
    )
    + theme_minimal()
    + theme(
        axis_title_x=element_text(size=15, face="bold"),
        axis_title_y=element_text(size=16, face="bold"),
        axis_text_x=element_text(size=18),
        axis_text_y=element_text(size=18),
        legend_position='bottom',
        legend_title=element_blank(),
        legend_text=element_text(size=14),
        plot_caption=element_text(ha='left', size=16),
        figure_size=(14, 6.5)
    )
)

plot.show()

# (opcional) salvar
# ggsave(plot=plot, filename=str(data_dir/'preco_palmer_semanal.png'), width=14, height=6.5, dpi=300)
# ggsave(plot=plot, filename=str(data_dir/'preco_palmer_semanal.svg'), width=14, height=6.5, dpi=300)
```

## PRE√áOS RECEBIDOS PELOS PRODUTORES

```{python agrinordeste11, echo=FALSE, message=FALSE}
import pandas as pd
from pathlib import Path
import plotnine as p9
from mizani.formatters import number_format, date_format

# Caminho para os arquivos
data_dir = Path("/Users/jricardofl/Dropbox/tempecon/dados_manga")

df = (
    pd.read_csv(data_dir/'dados_manga_tommy_semana.csv', sep=';', decimal='.')
    .drop(columns=['produto', 'regiao', 'ano', 'semana'])
)

# Cria o intervalo de dados de 2012-01-07 ate a semana de 2025
date_range = pd.date_range(start='2012-01-01', end='2025-09-05', freq='W-SAT')

# Remove datas especificas (semana 53)
dates_to_remove = [pd.Timestamp('2016-12-31'), pd.Timestamp('2022-12-31')]
date_range = date_range[~date_range.isin(dates_to_remove)]

# Designa a date range como uma nova coluna
df['date'] = date_range[:len(df)]

df['date2'] = date_range[:len(df)]

# Configura a data como index
df = df.set_index('date')

# Carrega igpdi dataset
igpdi = (
    pd.read_csv(data_dir/'igpdi.csv', sep=';', decimal='.')
    .assign(date=df.index)
    .drop(columns=['ano', 'semana'])
    .set_index('date')
)

# Junta os DataFrames
tabela = df.join(igpdi, how='inner')

# Deflaciona a serie de pre√ßos de manga
indice_data_base = tabela.query("date == date.max()").igpdi.values[0]
tabela = tabela.assign(real=lambda x: (indice_data_base / x.igpdi) * x.preco)

# Cria√ß√£o da vari√°vel preco_palmer
preco_palmer = tabela['real']

# Estima a tendEMcia por m√©dia m√≥vel
#trend_palmer = preco_palmer.rolling(window=52, center=True).mean()

# Gr√°fico

# Visualiza√ß√£o de dados

plot = (
    p9.ggplot(tabela) +
    p9.aes(x="date2") + 
    p9.geom_line(p9.aes(y="real"), color="darkgreen", size=1) + 
    scale_y_continuous(breaks=[1, 2, 3, 4, 5, 6, 7, 8]) +
    p9.scale_x_date(
        date_breaks="1 year", date_labels="%Y"
    ) +
    p9.labs(
        x="Semanas de cada ano",
        y="Pre√ßos deflacionados de Manga Tommy (R$/kg)",
        caption="Fonte: CEPEA (2025). Dados reprocessados pelo Observat√≥rio de Manga da Embrapa."
    ) +
    p9.theme_minimal() +
    p9.theme(
        axis_title_x=element_text(size=15, face="bold"),
        axis_title_y=element_text(size=16, face="bold"),
        axis_text_x=element_text(size=18),
        axis_text_y=element_text(size=18),
        legend_title=element_text(size=14),
        legend_text=element_text(size=12),
        plot_caption=element_text(ha='left', size=16),
        figure_size=(14, 6.5)
    )
)

# Mostra o gr√°fico
plot.show()
```

## PRE√áOS RECEBIDOS PELOS PRODUTORES

```{python agrinordeste12, echo=FALSE, message=FALSE}
import pandas as pd
from pathlib import Path
from plotnine import *

# ----------------------------
# 1) Leitura e prepara√ß√£o (seu bloco)
# ----------------------------
data_dir = Path("/Users/jricardofl/Dropbox/tempecon/dados_manga")

df = (
    pd.read_csv(data_dir/'dados_manga_tommy_semana.csv', sep=';', decimal='.')
    .drop(columns=['produto', 'regiao', 'ano', 'semana'])
)

# Intervalo semanal (W-SAT) e remo√ß√£o das semanas 53
date_range = pd.date_range(start='2012-01-01', end='2025-09-05', freq='W-SAT')
dates_to_remove = [pd.Timestamp('2016-12-31'), pd.Timestamp('2022-12-31')]
date_range = date_range[~date_range.isin(dates_to_remove)]

# Atribui datas e index
df['date'] = date_range[:len(df)]
df['date2'] = date_range[:len(df)]  # se precisar manter
df = df.set_index('date')

# IGP-DI com o mesmo √≠ndice temporal
igpdi = (
    pd.read_csv(data_dir/'igpdi.csv', sep=';', decimal='.')
    .assign(date=df.index)            # for√ßa alinhamento 1-para-1 por posi√ß√£o
    .drop(columns=['ano', 'semana'])
    .set_index('date')
)

# Join e deflacionamento
tabela = df.join(igpdi, how='inner')
indice_data_base = tabela.query("date == date.max()").igpdi.values[0]
tabela = tabela.assign(real=lambda x: (indice_data_base / x.igpdi) * x.preco)

# S√©rie final (pre√ßo real deflacionado)
preco_tommy = tabela['real']

# ----------------------------
# 2) Construir ano/semana (52 semanas por ano)
# ----------------------------
dados = tabela[['real']].rename(columns={'real': 'preco'})
dados['ano'] = dados.index.year
# semana = contagem sequencial dentro de cada ano (1..52)
dados['semana'] = dados.groupby('ano').cumcount() + 1

# Garantia: manter apenas semanas 1..52
dados = dados.query('1 <= semana <= 52').reset_index()

# ----------------------------
# 3) M√©dia semanal (2022‚Äì2024) e dados de barras (2023‚Äì2025)
# ----------------------------
media_224 = (
    dados.query('2022 <= ano <= 2024')
         .groupby('semana', as_index=False)['preco']
         .mean()
         .rename(columns={'preco': 'Media_2022_2024'})
)

bars = dados.query('ano in [2023, 2024, 2025]').copy()
bars['AnoLabel'] = bars['ano'].astype(str)

# ----------------------------
# 4) Plot (estilo da figura enviada)
# ----------------------------
cores_barras = {'2023': '#9ecae1', '2024': '#6b6b6b', '2025': '#FFD700'}

cor_linha   = {'M√©dia (2022‚Äì2024)': '#F2672b'}

plot = (
    ggplot()
    # Barras semanais
    + geom_col(
        aes(x='semana', y='preco', fill='AnoLabel'),
        data=bars,
        position=position_dodge(width=0.8),
        width=0.72
    )
    # Linha da m√©dia 2022‚Äì2024
    + geom_line(
        aes(x='semana', y='Media_2022_2024', group=1, color='"M√©dia (2022‚Äì2024)"'),
        data=media_224,
        size=1.6
    )
    + geom_point(
        aes(x='semana', y='Media_2022_2024', color='"M√©dia (2022‚Äì2024)"'),
        data=media_224,
        size=2.1
    )
    + scale_fill_manual(name='', values=cores_barras)
    + scale_color_manual(name='', values=cor_linha)
    + scale_x_continuous(breaks=range(1, 53, 3))   # <--- eixo de 3 em 3
    + labs(
        x='Semanas de cada Ano',
        y='Pre√ßo Tommy (R$)',
        caption='Fonte: CEPEA (2025). Dados reprocessados pelo Observat√≥rio de Manga da Embrapa.'
    )
    + theme_minimal()
    + theme(
        axis_title_x=element_text(size=15, face="bold"),
        axis_title_y=element_text(size=16, face="bold"),
        axis_text_x=element_text(size=18),
        axis_text_y=element_text(size=18),
        legend_position='bottom',
        legend_title=element_blank(),
        legend_text=element_text(size=14),
        plot_caption=element_text(ha='left', size=16),
        figure_size=(14, 6.5)
    )
)

plot.show()

# (opcional) salvar
# ggsave(plot=plot, filename=str(data_dir/'preco_palmer_semanal.png'), width=14, height=6.5, dpi=300)
# ggsave(plot=plot, filename=str(data_dir/'preco_palmer_semanal.svg'), width=14, height=6.5, dpi=300)
```

## A Qualidade das mangas

#### Temos sido negligentes com nossos clientes.


<div style="text-align: center;">
  <img src="imgs/sebraeba1.png" width="65%">
</div>

## A Qualidade das mangas

#### Produtos ruins n√£o aumentam a demanda.

<div style="text-align: center;">
  <img src="imgs/embala6.jpg" width="68%">
</div>

## A Qualidade das mangas

#### √â urgente **diferenciar um produto** ‚Äì sair da l√≥gica de commodity.

<div style="text-align: center;">
  <img src="imgs/sebraeba2.png" width="85%">
</div>

## Diferencia√ß√£o no mercado

<div style="text-align: center;">
  <img src="imgs/embala17.jpg" width="70%">
</div>

## A necessidade de embalar as mangas

::: columns
::: {.column width="50%"}

<br>

- A **Embalagem** √© uma vari√°vel estrat√©gica da cadeia de valor hortifrut√≠cola.

<br>

- A **Embalagem** √© a primeira vitrine do seu produto, o seu cart√£o de visita no ponto de venda.

<br>

- Use a **Embalagem** de forma estrat√©gica visando o crescimento do seu neg√≥cio.

:::
::: {.column width="50%"}

<div style="text-align: center;">
  <img src="imgs/sebraeba3.png" width="60%">
</div>

:::
:::

## Diferencia√ß√£o no mercado

- Hoje uvas s√£o vendidas de diversas formas.

<div style="text-align: center;">
  <img src="imgs/embala12.jpg" width="60%">
</div>

## Diferencia√ß√£o no mercado

<div style="text-align: center;">
  <img src="imgs/embala11.jpg" width="70%">
</div>

## Comercializa√ß√£o de uvas anos 90...

- Uvas comercializadas em caixas de madeira (03/1991  üì∑: M√¥nica Ishikawa).

<div style="text-align: center;">
  <img src="imgs/monica1.jpeg" width="60%">
</div>

## Diferencia√ß√£o no mercado

- Embalagens criam identidade visual e destacam o produto.

<div style="text-align: center;">
  <img src="imgs/embala13a.png" width="90%">
</div>


## Precisamos rever como vendemos as mangas

<div style="text-align: center;">
  <img src="imgs/ambiente7.jpg" width="78%">
</div>

## Precisamos rever como vendemos as mangas

<div style="text-align: center;">
  <img src="imgs/sebraeba4.jpg" width="68%">
</div>

## Precisamos rever como vendemos as mangas

<div style="text-align: center;">
  <img src="imgs/sebraeba5.jpg" width="70%">
</div>

## Precisamos rever como vendemos as mangas

<div style="text-align: center;">
  <img src="imgs/sebraeba6.jpg" width="50%">
</div>

## Precisamos rever como vendemos as mangas

<div style="text-align: center;">
  <img src="imgs/sebraeba7.jpg" width="65%">
</div>

## Precisamos rever como vendemos as mangas

<div style="text-align: center;">
  <img src="imgs/embala29.png" width="80%">
</div>

## Precisamos rever como vendemos as mangas

<div style="text-align: center;">
  <img src="imgs/embala30.png" width="60%">
</div>

## Precisamos rever como vendemos as mangas

<div style="text-align: center;">
  <img src="imgs/manga_embalada.png" width="75%">
</div>

## Precisamos rever como vendemos as mangas

<div style="text-align: center;">
  <img src="imgs/sebraeba9.jpg" width="55%">
</div>

## Precisamos rever como vendemos as mangas

<div style="text-align: center;">
  <img src="imgs/sebraeba8.jpg" width="68%">
</div>

# A CULTURA DA UVA

## AN√ÅLISE DA PRODU√á√ÉO DE UVA  

#### Cada ano aumentam as √°reas cultivadas e a produtividade na regi√£o.

<div style="text-align: center;">
  <img src="imgs/area_uva.png" width="75%">
</div>

Fonte: [CEPEA, 2025.](https://www.hfbrasil.org.br/br/revista/acessar/completo/edicao-de-dezembro-anuario-2024-2025.aspx)

## AN√ÅLISE DA OFERTA DE UVA  

#### Nos √∫ltimos 10 anos, a produ√ß√£o de uvas cresceu rapidamente.

```{python agrinordeste13, echo=FALSE, out.width="100%"}
from plotnine import *
import pandas as pd
import numpy as np

# Lendo os dados
dados2 = pd.read_excel("dados/tabela1.xlsx")
dados2["Ano"] = dados2["Ano"].astype(str)

# Gr√°fico
plot = (
    ggplot(dados2) +
    geom_col(aes(x='Ano', y='Uva / 1000'), fill="purple") +
    scale_y_continuous(breaks=[100, 200, 300, 400, 500, 600]) +
    labs(
        y='Mil Toneladas',
        x='anos',
        caption='Fonte: IBGE (2024). Dados reprocessados pelo Observat√≥rio de Uva da Embrapa.'
    ) +
    theme_minimal() +
    theme(
        axis_text_x=element_text(angle=45, ha='center', size=18),
        axis_text_y=element_text(size=18),
        axis_title_x=element_text(size=18, weight='bold'),
        axis_title_y=element_text(size=18, weight='bold'),
        panel_grid_major=element_blank(),
        panel_grid_minor=element_blank(),
        plot_caption=element_text(ha='left', size=16),
        legend_title=element_blank(),
        legend_text=element_text(size=8),
        legend_position='none',
        figure_size=(14, 6.5)
    )
)

plot.show

```

# O MERCADO EXTERNO

## EXPORTA√á√ïES BRASILEIRAS DE UVAS

```{python agrinordeste14, echo=FALSE, message=FALSE}
import pandas as pd
from plotnine import *

# Carregar os dados
dados1 = pd.read_csv('dados/exportacoes_2016_2025.csv', sep=';', decimal='.')
# Garante os nomes das colunas (ajuste se o CSV j√° vier nomeado)
dados1.columns = ['Ano', 'Valor', 'Toneladas']

# Sequ√™ncia de anos 2012..2025 (comprimEMto = n√∫mero de linhas do arquivo)
dados1['Ano'] = pd.RangeIndex(start=2016, stop=2016 + len(dados1), step=1)

# Converte unidades para milhares apEMas nas colunas num√©ricas desejadas
dados1[['Valor', 'Toneladas']] = dados1[['Valor', 'Toneladas']] / 1000000

plot = (
    ggplot(dados1, aes(x='Ano'))
    # Barras: Mil Toneladas
+ geom_col(aes(y='Toneladas', fill='"Mil toneladas"'), width=0.8, show_legend=True)
+ geom_line(aes(y='Valor', color='"Milh√µes de d√≥lares"'), size=2.2, show_legend=True)
+ scale_fill_manual(name='', values={'Mil toneladas': '#FFD700'})
+ scale_color_manual(name='', values={'Milh√µes de d√≥lares': '#FF0000'})
    + guides(fill=guide_legend(order=1), color=guide_legend(order=2))
    # Eixos, r√≥tulos e quebras
    + scale_x_continuous(breaks=range(2016, 2026))
    + labs(
    x='anos',
    y='US$ Milh√µes / Mil Toneladas',
    title='',
    caption='Fonte: COMEXSTAT (2025). Dados reprocessados pelo Observat√≥rio de Uva da Embrapa.\n'
            'Obs.: Dados at√© o m√™s de Agosto de 2025.'
    )
    + theme_minimal()
    + theme(
        legend_position='bottom',
        legend_title=element_blank(),
        legend_text=element_text(size=18),
        axis_title_x=element_text(weight='bold', size=18),
        axis_title_y=element_text(weight='bold', size=18),
        axis_text_x=element_text(size=18),
        axis_text_y=element_text(size=18),
        plot_caption=element_text(ha='left', size=18),
        figure_size=(14, 6.5)
    )
)

plot.show

```

## EXPORTA√á√ïES BRASILEIRAS DE UVAS

```{python agrinordeste14a, echo=FALSE, message=FALSE}
# pip install pandas plotnine
import pandas as pd
from plotnine import *

# --- 1) Ler dados e preparar ---
df = pd.read_csv('dados/total_exporta_uva_br.csv', sep=';', decimal='.')  # troque decimal=',' se precisar

# nomes esperados: ano, mes, valor, quilo
df.columns = [c.strip().lower() for c in df.columns]

# quilo ‚Üí mil toneladas
df['toneladas'] = df['quilo'] / 1000000

# meses em PT-BR (ordem correta)
mes_map = {
    1: 'janeiro',  2: 'fevereiro', 3: 'mar√ßo',    4: 'abril',
    5: 'maio',     6: 'junho',     7: 'julho',    8: 'agosto',
    9: 'setembro', 10: 'outubro',  11: 'novembro', 12: 'dezembro'
}

ordem_meses = [mes_map[m] for m in range(1,13)]
df['Mes'] = df['mes'].map(mes_map)
df['Mes'] = pd.Categorical(df['Mes'], categories=ordem_meses, ordered=True)

# --- 2) M√©dia mEMsal (2016‚Äì2024) ---
media_1624 = (
    df.query('2016 <= ano <= 2024')
      .groupby('Mes', as_index=False)['toneladas']
      .mean()
      .rename(columns={'toneladas':'Media_2016_2024'})
)

# --- 3) Dados das barras (2023, 2024, 2025) ---
bars = df[df['ano'].isin([2023, 2024, 2025])].copy()
bars['AnoLabel'] = bars['ano'].astype(str)  # '2023','2024','2025'

# --- 4) Cores (ajuste se quiser chegar 100% no seu palette) ---
cores_barras = {'2023': '#9ecae1', '2024': '#6b6b6b', '2025': '#FFD700'}  # azul claro, cinza, amarelo
cor_linha   = {'Media (2016‚Äì2024)': '#F2672b'}  # laranja

plot = (
    ggplot()
    # Barras
    + geom_col(
        mapping=aes(x='Mes', y='toneladas', fill='AnoLabel'),
        data=bars,
        position=position_dodge(width=0.8),
        width=0.75,
        show_legend=True
    )
    # Linha m√©dia 2012‚Äì2024
    + geom_line(
        mapping=aes(x='Mes', y='Media_2016_2024', group=1, color='"Media (2016‚Äì2024)"'),
        data=media_1624,
        size=1.8,
        show_legend=True
    )
    + geom_point(
        mapping=aes(x='Mes', y='Media_2016_2024', color='"Media (2016‚Äì2024)"'),
        data=media_1624,
        size=2.2,
        show_legend=False
    )
    + scale_fill_manual(name='', values={'2023':'#9ecae1','2024':'#6b6b6b','2025':'#FFD700'})
    + scale_color_manual(name='', values={'Media (2016‚Äì2024)':'#F2672b'})
+ labs(
    x='Meses del ano',
    y='Mil Toneladas',
    caption='Fonte: COMEXSTAT (2025). Dados reprocessados pelo Observat√≥rio de Uva da Embrapa.\n'
            'Obs.: Dados at√© o m√™s de Agosto de 2025.'
)

    + theme_minimal()    
    + theme(
        legend_position='bottom',
        legend_title=element_blank(),
        legend_text=element_text(size=18),
        axis_title_x=element_text(weight='bold', size=18),
        axis_title_y=element_text(weight='bold', size=18),
        axis_text_x=element_text(size=16),
        axis_text_y=element_text(size=18),
        plot_caption=element_text(ha='left', size=18),
        figure_size=(14, 6.5)
    )
)


plot.show()
```

## EXPORTA√á√ïES BRASILEIRAS DE UVAS

```{python agrinordeste15a, echo=FALSE, message=FALSE}
import pandas as pd
from plotnine import *

# --- 1) Ler ---
df = pd.read_excel('dados/destinos_uva_2425.xlsx')
df.columns = ['Paises', '2024', '2025']

# Padronizar nomes (se precisar)
df['Paises'] = df['Paises'].replace({
    'Paises Bajos': 'Holanda',
    'Espanha': 'Espanha',
    'Canada': 'Canada',
    'Coreia do Sul': 'Coreia do Sul',
    'Estados Unidos': 'Estados Unidos'
})

# 2) Converter colunas de valores para num√©rico
for c in ['2024', '2025']:
    # remove percentuais e separadores t√≠picos
    df[c] = (df[c].astype(str)
                  .str.replace('%', '', regex=False)
                  .str.replace('.', '', regex=False)     # separador de milhar
                  .str.replace(',', '.', regex=False))   # v√≠rgula -> ponto
    df[c] = pd.to_numeric(df[c], errors='coerce')

# 3) escolher nome da coluna de pa√≠ses
col = 'Pa√≠ses' if 'Pa√≠ses' in df.columns else 'Paises'

# 4) ordem desejada (use exatamente os mesmos nomes da coluna!)
ordem = ['Holanda', 'Estados Unidos', 'Reino Unido', 'Espanha', 'Argentina',  'Canada', 'Alemanha', 'Uruguai'] 

df[col] = pd.Categorical(df[col], categories=ordem, ordered=True)

# 5) Derreter (melt)
dados1m = df.melt(id_vars=col, var_name='variable', value_name='value')

# label sem casas decimais; vazio quando NaN/inf
#dados1m['label'] = dados1m['value'].map(
#    lambda v: "" if (pd.isna(v) or not np.isfinite(v)) else f"{v:.0f}"
#)

# 6) Gr√°fico
mycolors2 = ["#006400", "#FFA500"]

plot = (
    ggplot(dados1m, aes(x=col, y='value', fill='variable'))
    + geom_col(position=position_dodge(width=0.9), na_rm=True)
    + geom_text(
        aes(label='value'),
        position=position_dodge(0.9),
        va='bottom',
        size=14
    )
    + scale_fill_manual(values=mycolors2)
    + labs(
        y="Participa√ß√£o (%)",
        x="Pa√≠ses",
        title="",
        caption="Fonte: COMEXSTAT (2025). Dados reprocessados pelo Observat√≥rio de Uva da Embrapa."
    )
    + theme_minimal()
    + theme(
        figure_size=(14, 6.5),
        axis_title_y=element_text(size=18, weight="bold"),
        axis_title_x=element_text(size=18, weight="bold"),
        axis_text_x=element_text(hjust=0.5, size=15),
        axis_text_y=element_text(size=18),
        plot_caption=element_text(ha='left', size=16),
        legend_position='bottom',
        legend_text=element_text(size=16),
        legend_title=element_text(text='')
    )
)

# Em notebooks Python: print(plot) ou plot.save("grafico.png", dpi=300, width=14, height=6.5)

# Mostrar o gr√°fico
plot.show()

```

# O MERCADO INTERNO

- DEMANDA
- PRE√áOS

## AN√ÅLISE DA DEMANDA DE UVA 

```{python agrinordeste15, echo=FALSE, message=FALSE}

import pandas as pd
from plotnine import *
from mizani.formatters import date_format
import matplotlib.pyplot as plt

# Load the CSV file
data = pd.read_csv('dados/ipca_uva.csv', sep=';', decimal='.')

# Traduzir os meses do portugu√™s para o ingl√™s
meses_pt_en = {
    'jan': 'Jan', 'fev': 'Feb', 'mar': 'Mar', 'abr': 'Apr',
    'mai': 'May', 'jun': 'Jun', 'jul': 'Jul', 'ago': 'Aug',
    'set': 'Sep', 'out': 'Oct', 'nov': 'Nov', 'dez': 'Dec'
}

# Aplicar substitui√ß√£o
data['mes_EM'] = data['mes'].str.lower().replace(meses_pt_en, regex=True)

# Converter para datetime
data['mes_EM'] = pd.to_datetime(data['mes_EM'], format='%b/%y')

# Criar o gr√°fico
plot = (
    ggplot(data, aes(x='mes_EM', y='pe_uva')) +
    geom_line(color='darkblue', size=1.5) +
    labs(
        title='',
        x='Meses do ano',
        y='Peso no or√ßamento da Fam√≠lia',
        caption='Fonte: IPCA/IBGE (2025). Dados reprocessados pelo Observat√≥rio de Uva da Embrapa.'
    ) +
    scale_x_datetime(date_breaks='6 months', date_labels='%b/%y') +
    theme_minimal() +
    theme(
        figure_size=(14, 6.5),
        axis_title_y=element_text(size=14, face="bold"),
        axis_title_x=element_text(size=14, face="bold"),
        axis_text_x=element_text(rotation=45, hjust=1, size=14),
        axis_text_y=element_text(size=18),
        plot_caption=element_text(ha='left', size=12)
    )
)

# Mostrar o gr√°fico
plot.show()

```

## PRE√áOS RECEBIDOS PELOS PRODUTORES

```{python agrinordeste16, echo=FALSE, message=FALSE}
# Aqui vamos usar o R para fazer o imputation com o Filtro de Kalman
# e depois continuar usando o Python
#```{r agrinordeste15, echo=FALSE, message=FALSE}
#setwd('/Users/jricardofl/Dropbox/tempecon/dados_uva')

#library(imputeTS)

#Entrando dados no R Branca Arra-15
#dados1 <- read.csv2('dados_uva_arra_semana.csv', header=T, sep=";", dec=".")
#dados <- dados[,-c(9:10)] #retirar as ultimas colunas
#colnames(dados1)[1]<-'produto'
#Resolver os Missing
#dados1 <-na_kalman(dados1)

#write.csv2(dados1, "dados_uva_arra_semana_imputado.csv",
#           row.names = FALSE, na = "", fileEncoding = "UTF-8")
#```

import pandas as pd
from pathlib import Path
import plotnine as p9
from mizani.formatters import number_format, date_format

# Caminho para os arquivos
data_dir = Path("/Users/jricardofl/Dropbox/tempecon/dados_uva")

df = (
    pd.read_csv(data_dir/'dados_uva_arra_semana_imputado.csv', sep=';', decimal=',')
    .drop(columns=['produto', 'ano', 'semana'])
)
                 
# Cria o intervalo de dados de 2012-01-07 ate a semana de 2025
date_range = pd.date_range(start='2017-01-01', end='2025-09-05', freq='W-SAT')

# Remove datas especificas (semana 53)
dates_to_remove = [pd.Timestamp('2022-12-31')]
date_range = date_range[~date_range.isin(dates_to_remove)]

# Designa a date range como uma nova coluna
df['date'] = date_range[:len(df)]

df['date2'] = date_range[:len(df)]

# Configura a data como index
df = df.set_index('date')

# Carrega igpdi dataset
igpdi = (
    pd.read_csv(data_dir/'igpdi_uva.csv', sep=';', decimal='.')
    .assign(date=df.index)
    .drop(columns=['ano', 'semana'])
    .set_index('date')
)

# Junta os DataFrames
tabela = df.join(igpdi, how='inner')

# Deflaciona a serie de pre√ßos de manga
indice_data_base = tabela.query("date == date.max()").igpdi.values[0]
tabela = tabela.assign(real=lambda x: (indice_data_base / x.igpdi) * x.preco)

# Cria√ß√£o da vari√°vel preco_palmer
preco_arra = tabela['real']

# Estima a tendEMcia por m√©dia m√≥vel
#trend_palmer = preco_palmer.rolling(window=52, center=True).mean()

# Gr√°fico

# Visualiza√ß√£o de dados

plot = (
    p9.ggplot(tabela) +
    p9.aes(x="date2") + 
    p9.geom_line(p9.aes(y="real"), color="darkgreen", size=1.5) + 
    scale_y_continuous(limits=(0, 20), expand=(0, 0)) +
    p9.scale_x_date(
        date_breaks="1 year", date_labels="%Y"
    ) +
    p9.labs(
        x="Semanas de cada ano",
        y="Pre√ßos deflac. de Uva Branca sem Semente (R$/kg)",
        caption="Fonte: CEPEA (2025). Dados reprocessados pelo Observat√≥rio de Uva da Embrapa."
    ) +
    p9.theme_minimal() +
    p9.theme(
        axis_title_x=element_text(size=15, face="bold"),
        axis_title_y=element_text(size=16, face="bold"),
        axis_text_x=element_text(size=18),
        axis_text_y=element_text(size=18),
        legend_title=element_text(size=14),
        legend_text=element_text(size=12),
        plot_caption=element_text(ha='left', size=16),
        figure_size=(14, 6.5)
    )
)

# Mostra o gr√°fico
plot.show()
```

## PRE√áOS RECEBIDOS PELOS PRODUTORES

```{python agrinordeste17, echo=FALSE, message=FALSE}
import pandas as pd
from pathlib import Path
from plotnine import *

# ----------------------------
# 1) Leitura e prepara√ß√£o (seu bloco)
# ----------------------------
data_dir = Path("/Users/jricardofl/Dropbox/tempecon/dados_uva")

df = (
    pd.read_csv(data_dir/'dados_uva_arra_semana_imputado.csv', sep=';', decimal=',')
    .drop(columns=['produto', 'ano', 'semana'])
)

# Cria o intervalo de dados de 2012-01-07 ate a semana de 2025
date_range = pd.date_range(start='2017-01-01', end='2025-09-05', freq='W-SAT')

# Remove datas especificas (semana 53)
dates_to_remove = [pd.Timestamp('2022-12-31')]
date_range = date_range[~date_range.isin(dates_to_remove)]

# Designa a date range como uma nova coluna
df['date'] = date_range[:len(df)]

df['date2'] = date_range[:len(df)]

df = df.set_index('date')

# IGP-DI com o mesmo √≠ndice temporal
igpdi = (
    pd.read_csv(data_dir/'igpdi_uva.csv', sep=';', decimal='.')
    .assign(date=df.index)            # for√ßa alinhamento 1-para-1 por posi√ß√£o
    .drop(columns=['ano', 'semana'])
    .set_index('date')
)

# Join e deflacionamento
tabela = df.join(igpdi, how='inner')
indice_data_base = tabela.query("date == date.max()").igpdi.values[0]
tabela = tabela.assign(real=lambda x: (indice_data_base / x.igpdi) * x.preco)

# S√©rie final (pre√ßo real deflacionado)
preco_vitoria = tabela['real']

# ----------------------------
# 2) Construir ano/semana (52 semanas por ano)
# ----------------------------
dados = tabela[['real']].rename(columns={'real': 'preco'})
dados['ano'] = dados.index.year
# semana = contagem sequencial dentro de cada ano (1..52)
dados['semana'] = dados.groupby('ano').cumcount() + 1

# Garantia: manter apenas semanas 1..52
dados = dados.query('1 <= semana <= 52').reset_index()

# ----------------------------
# 3) M√©dia semanal (2022‚Äì2024) e dados de barras (2023‚Äì2025)
# ----------------------------
media_224 = (
    dados.query('2022 <= ano <= 2024')
         .groupby('semana', as_index=False)['preco']
         .mean()
         .rename(columns={'preco': 'Media_2022_2024'})
)

bars = dados.query('ano in [2023, 2024, 2025]').copy()
bars['AnoLabel'] = bars['ano'].astype(str)

# ----------------------------
# 4) Plot (estilo da figura enviada)
# ----------------------------
cores_barras = {'2023': '#9ecae1', '2024': '#6b6b6b', '2025': '#FFD700'}

cor_linha   = {'M√©dia (2022‚Äì2024)': '#F2672b'}

plot = (
    ggplot()
    # Barras semanais
    + geom_col(
        aes(x='semana', y='preco', fill='AnoLabel'),
        data=bars,
        position=position_dodge(width=0.8),
        width=0.72
    )
    # Linha da m√©dia 2022‚Äì2024
    + geom_line(
        aes(x='semana', y='Media_2022_2024', group=1, color='"M√©dia (2022‚Äì2024)"'),
        data=media_224,
        size=1.6
    )
    + geom_point(
        aes(x='semana', y='Media_2022_2024', color='"M√©dia (2022‚Äì2024)"'),
        data=media_224,
        size=2.1
    )
    + scale_fill_manual(name='', values=cores_barras)
    + scale_color_manual(name='', values=cor_linha)
    + scale_x_continuous(breaks=range(1, 53, 3))   # <--- eixo de 3 em 3
    + labs(
        x='Semanas de cada Ano',
        y='Pre√ßo deflac. de Uva Branca sem Semente (R$)',
        caption='Fonte: CEPEA (2025). Dados reprocessados pelo Observat√≥rio de Uva da Embrapa.'
    )
    + theme_minimal()
    + theme(
        axis_title_x=element_text(size=15, face="bold"),
        axis_title_y=element_text(size=16, face="bold"),
        axis_text_x=element_text(size=18),
        axis_text_y=element_text(size=18),
        legend_position='bottom',
        legend_title=element_blank(),
        legend_text=element_text(size=14),
        plot_caption=element_text(ha='left', size=16),
        figure_size=(14, 6.5)
    )
)

plot.show()

# (opcional) salvar
# ggsave(plot=plot, filename=str(data_dir/'preco_palmer_semanal.png'), width=14, height=6.5, dpi=300)
# ggsave(plot=plot, filename=str(data_dir/'preco_palmer_semanal.svg'), width=14, height=6.5, dpi=300)
```

## PRE√áOS RECEBIDOS PELOS PRODUTORES

```{python agrinordeste18, echo=FALSE, message=FALSE}
# Aqui vamos usar o R para fazer o imputation com o Filtro de Kalman
# e depois continuar usando o Python
#```{r agrinordeste15, echo=FALSE, message=FALSE}
#setwd('/Users/jricardofl/Dropbox/tempecon/dados_uva')

#library(imputeTS)

#Entrando dados no R Branca Arra-15
#dados1 <- read.csv2('dados_uva_arra_semana.csv', header=T, sep=";", dec=".")
#dados <- dados[,-c(9:10)] #retirar as ultimas colunas
#colnames(dados1)[1]<-'produto'
#Resolver os Missing
#dados1 <-na_kalman(dados1)

#write.csv2(dados1, "dados_uva_arra_semana_imputado.csv",
#           row.names = FALSE, na = "", fileEncoding = "UTF-8")
#```

import pandas as pd
from pathlib import Path
import plotnine as p9
from mizani.formatters import number_format, date_format

# Caminho para os arquivos
data_dir = Path("/Users/jricardofl/Dropbox/tempecon/dados_uva")

df = (
    pd.read_csv(data_dir/'dados_uva_vitoria_semana_imputado.csv', sep=';', decimal=',')
    .drop(columns=['produto', 'ano', 'semana'])
)
                 
# Cria o intervalo de dados de 2012-01-07 ate a semana de 2025
date_range = pd.date_range(start='2017-01-01', end='2025-09-05', freq='W-SAT')

# Remove datas especificas (semana 53)
dates_to_remove = [pd.Timestamp('2022-12-31')]
date_range = date_range[~date_range.isin(dates_to_remove)]

# Designa a date range como uma nova coluna
df['date'] = date_range[:len(df)]

df['date2'] = date_range[:len(df)]

# Configura a data como index
df = df.set_index('date')

# Carrega igpdi dataset
igpdi = (
    pd.read_csv(data_dir/'igpdi_uva.csv', sep=';', decimal='.')
    .assign(date=df.index)
    .drop(columns=['ano', 'semana'])
    .set_index('date')
)

# Junta os DataFrames
tabela = df.join(igpdi, how='inner')

# Deflaciona a serie de pre√ßos de uva
indice_data_base = tabela.query("date == date.max()").igpdi.values[0]
tabela = tabela.assign(real=lambda x: (indice_data_base / x.igpdi) * x.preco)

# Cria√ß√£o da vari√°vel preco_palmer
preco_vitoria = tabela['real']

# Estima a tendEMcia por m√©dia m√≥vel
#trend_palmer = preco_palmer.rolling(window=52, center=True).mean()

# Gr√°fico

# Visualiza√ß√£o de dados

plot = (
    p9.ggplot(tabela) +
    p9.aes(x="date2") + 
    p9.geom_line(p9.aes(y="real"), color="red", size=1.5) + 
    scale_y_continuous(limits=(0, 20), expand=(0, 0)) +
    p9.scale_x_date(
        date_breaks="1 year", date_labels="%Y"
    ) +
    p9.labs(
        x="Semanas de cada ano",
        y="Pre√ßos deflac. de Uva Negra sem Semente (R$/kg)",
        caption="Fonte: CEPEA (2025). Dados reprocessados pelo Observat√≥rio de Uva da Embrapa."
    ) +
    p9.theme_minimal() +
    p9.theme(
        axis_title_x=element_text(size=15, face="bold"),
        axis_title_y=element_text(size=16, face="bold"),
        axis_text_x=element_text(size=18),
        axis_text_y=element_text(size=18),
        legend_title=element_text(size=14),
        legend_text=element_text(size=12),
        plot_caption=element_text(ha='left', size=16),
        figure_size=(14, 6.5)
    )
)

# Mostra o gr√°fico
plot.show()
```

## PRE√áOS RECEBIDOS PELOS PRODUTORES

```{python agrinordeste19, echo=FALSE, message=FALSE}
import pandas as pd
from pathlib import Path
from plotnine import *

# ----------------------------
# 1) Leitura e prepara√ß√£o (seu bloco)
# ----------------------------
data_dir = Path("/Users/jricardofl/Dropbox/tempecon/dados_uva")

df = (
    pd.read_csv(data_dir/'dados_uva_vitoria_semana_imputado.csv', sep=';', decimal=',')
    .drop(columns=['produto', 'ano', 'semana'])
)

# Cria o intervalo de dados de 2012-01-07 ate a semana de 2025
date_range = pd.date_range(start='2017-01-01', end='2025-09-05', freq='W-SAT')

# Remove datas especificas (semana 53)
dates_to_remove = [pd.Timestamp('2022-12-31')]
date_range = date_range[~date_range.isin(dates_to_remove)]

# Designa a date range como uma nova coluna
df['date'] = date_range[:len(df)]

df['date2'] = date_range[:len(df)]

df = df.set_index('date')

# IGP-DI com o mesmo √≠ndice temporal
igpdi = (
    pd.read_csv(data_dir/'igpdi_uva.csv', sep=';', decimal='.')
    .assign(date=df.index)            # for√ßa alinhamento 1-para-1 por posi√ß√£o
    .drop(columns=['ano', 'semana'])
    .set_index('date')
)

# Join e deflacionamento
tabela = df.join(igpdi, how='inner')
indice_data_base = tabela.query("date == date.max()").igpdi.values[0]
tabela = tabela.assign(real=lambda x: (indice_data_base / x.igpdi) * x.preco)

# S√©rie final (pre√ßo real deflacionado)
preco_vitoria = tabela['real']

# ----------------------------
# 2) Construir ano/semana (52 semanas por ano)
# ----------------------------
dados = tabela[['real']].rename(columns={'real': 'preco'})
dados['ano'] = dados.index.year
# semana = contagem sequencial dentro de cada ano (1..52)
dados['semana'] = dados.groupby('ano').cumcount() + 1

# Garantia: manter apenas semanas 1..52
dados = dados.query('1 <= semana <= 52').reset_index()

# ----------------------------
# 3) M√©dia semanal (2022‚Äì2024) e dados de barras (2023‚Äì2025)
# ----------------------------
media_224 = (
    dados.query('2022 <= ano <= 2024')
         .groupby('semana', as_index=False)['preco']
         .mean()
         .rename(columns={'preco': 'Media_2022_2024'})
)

bars = dados.query('ano in [2023, 2024, 2025]').copy()
bars['AnoLabel'] = bars['ano'].astype(str)

# ----------------------------
# 4) Plot (estilo da figura enviada)
# ----------------------------
cores_barras = {'2023': '#9ecae1', '2024': '#6b6b6b', '2025': '#FFD700'}

cor_linha   = {'M√©dia (2022‚Äì2024)': '#F2672b'}

plot = (
    ggplot()
    # Barras semanais
    + geom_col(
        aes(x='semana', y='preco', fill='AnoLabel'),
        data=bars,
        position=position_dodge(width=0.8),
        width=0.72
    )
    # Linha da m√©dia 2022‚Äì2024
    + geom_line(
        aes(x='semana', y='Media_2022_2024', group=1, color='"M√©dia (2022‚Äì2024)"'),
        data=media_224,
        size=1.6
    )
    + geom_point(
        aes(x='semana', y='Media_2022_2024', color='"M√©dia (2022‚Äì2024)"'),
        data=media_224,
        size=2.1
    )
    + scale_fill_manual(name='', values=cores_barras)
    + scale_color_manual(name='', values=cor_linha)
    + scale_x_continuous(breaks=range(1, 53, 3))   # <--- eixo de 3 em 3
    + labs(
        x='Semanas de cada Ano',
        y='Pre√ßo deflac. de Uva Negra sem Semente (R$)',
        caption='Fonte: CEPEA (2025). Dados reprocessados pelo Observat√≥rio de Uva da Embrapa.'
    )
    + theme_minimal()
    + theme(
        axis_title_x=element_text(size=15, face="bold"),
        axis_title_y=element_text(size=16, face="bold"),
        axis_text_x=element_text(size=18),
        axis_text_y=element_text(size=18),
        legend_position='bottom',
        legend_title=element_blank(),
        legend_text=element_text(size=14),
        plot_caption=element_text(ha='left', size=16),
        figure_size=(14, 6.5)
    )
)

plot.show()

# (opcional) salvar
# ggsave(plot=plot, filename=str(data_dir/'preco_palmer_semanal.png'), width=14, height=6.5, dpi=300)
# ggsave(plot=plot, filename=str(data_dir/'preco_palmer_semanal.svg'), width=14, height=6.5, dpi=300)
```


# O MERCADO INTERNO

- DESAFIOS

## PROBLEMAS NA CADEIA DE FRIO

- Estas frutas n√£o poderiam estar na gond√¥la do varejo

<div style="text-align: center;">
  <img src="imgs/problema1.png" width="100%">
</div>

## PROBLEMAS NA CADEIA DE FRIO

- Estas frutas n√£o poderiam estar na gond√¥la do varejo

<div style="text-align: center;">
  <img src="imgs/problema2.png" width="90%">
</div>

## Sustentabilidade √© realidade n√£o tend√™ncia

<div style="text-align: center;">
  <img src="imgs/ambiente6.jpg" width="70%">
</div>

## Sustentabilidade √© realidade n√£o tend√™ncia

<div style="text-align: center;">
  <img src="imgs/ambiente1.jpg" width="90%">
</div>

## Sustentabilidade √© realidade n√£o tend√™ncia

<div style="text-align: center;">
  <img src="imgs/embalagem2.jpg" width="70%">
</div>

## Sustentabilidade √© realidade n√£o tend√™ncia

<div style="text-align: center;">
  <img src="imgs/ambiente2.jpg" width="65%">
</div>

## Sustentabilidade √© realidade n√£o tend√™ncia

<div style="text-align: center;">
  <img src="imgs/ambiente3.jpg" width="65%">
</div>

## Sustentabilidade √© realidade n√£o tend√™ncia

<div style="text-align: center;">
  <img src="imgs/ambiente4.jpg" width="70%">
</div>

## Sustentabilidade √© realidade n√£o tend√™ncia

<div style="text-align: center;">
  <img src="imgs/ambiente8.jpg" width="76%">
</div>


## Sustentabilidade √© realidade n√£o tend√™ncia

<div style="text-align: center;">
  <img src="imgs/ambiente9.jpg" width="90%">
</div>

## Sustentabilidade √© realidade n√£o tend√™ncia

<div style="text-align: center;">
  <img src="imgs/ambiente10.jpg" width="72%">
</div>

## Sustentabilidade √© realidade n√£o tend√™ncia

<div style="text-align: center;">
  <img src="imgs/ambiente11.jpg" width="70%">
</div>

## Sustentabilidade √© realidade n√£o tend√™ncia

<div style="text-align: center;">
  <img src="imgs/ambiente14.jpg" width="85%">
</div>

## Sustentabilidade √© realidade n√£o tend√™ncia

<div style="text-align: center;">
  <img src="imgs/ambiente15.jpg" width="70%">
</div>

## Sustentabilidade √© realidade n√£o tend√™ncia

<div style="text-align: center;">
  <img src="imgs/ambiente16.jpg" width="65%">
</div>

## Sustentabilidade √© realidade n√£o tend√™ncia

<div style="text-align: center;">
  <img src="imgs/ambiente17.jpg" width="92%">
</div>

## Sustentabilidade √© realidade n√£o tend√™ncia

<div style="text-align: center;">
  <img src="imgs/ambiente18.jpg" width="75%">
</div>

## DESAFIOS CHAVE NESTE NOVO CONTEXTO

<br>

### Reduzir a diferen√ßa entre a oferta e a demanda

- **Aumentar o consumo no mercado interno**.
- Vender em **novos mercados**.
- Organizar melhor a **distribui√ß√£o do volume** ao longo do ano.
- Conseguir alternativas para **agrega√ß√£o de valor**. 


### Reduzir os custos de produ√ß√£o (e custo Brasil) para aumentar a competitividade

- At√© quando o D√≥lar seguir√° se depreciando em rela√ß√£o ao Real?


### Fazer a gest√£o do neg√≥cio de forma profissional.

- N√£o existem muitos dados de mercado dispon√≠veis para a cultura da manga.


## {.center .thankslide}

::: columns
::: {.column width="60%"}

<div style="text-align: center;">
  <img src="imgs/logo_agri25.png" width="70%">
</div>


:::
::: {.column width="40%"}

<div style="text-align: center;">
  <img src="imgs/logo_manga.png" width="60%">
</div>

:::
:::

 <div style="text-align: center;"> 
  <h2 style="color: #282f6b; font-size: 2em; margin-bottom: 20px;">
    MUITO OBRIGADO!
  </h2>
  <br>
  <!-- This part will have a smaller font size -->
  <p style="font-size: 0.8em; color: #333;">
    <a href="https://www.embrapa.br/observatorio-da-manga" target="_blank">
      https://www.embrapa.br/observatorio-da-manga
    </a>
    <br>
    <a href="https://www.embrapa.br/observatorio-da-uva" target="_blank">
      https://www.embrapa.br/observatorio-da-uva
    </a>
    <br>
üì≤ **WhatsApp:** <br>
+55 87 99961-5799  
  </p>
  <br>
  <img src="imgs/apoio2.png" width="23%">
</div>


